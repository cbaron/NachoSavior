(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";module.exports={Admin:require("./views/templates/Admin"),AdminItem:require("./views/templates/AdminItem"),Comic:require("./views/templates/Comic"),ComicManage:require("./views/templates/ComicManage"),ComicResources:require("./views/templates/ComicResources"),Header:require("./views/templates/Header"),Home:require("./views/templates/Home"),Login:require("./views/templates/Login"),User:require("./views/templates/User"),UserManage:require("./views/templates/UserManage"),UserResources:require("./views/templates/UserResources")}},{"./views/templates/Admin":24,"./views/templates/AdminItem":25,"./views/templates/Comic":26,"./views/templates/ComicManage":27,"./views/templates/ComicResources":28,"./views/templates/Header":29,"./views/templates/Home":30,"./views/templates/Login":31,"./views/templates/User":32,"./views/templates/UserManage":33,"./views/templates/UserResources":34}],2:[function(require,module,exports){"use strict";module.exports={Admin:require("./views/Admin"),AdminItem:require("./views/AdminItem"),Comic:require("./views/Comic"),ComicManage:require("./views/ComicManage"),ComicResources:require("./views/ComicResources"),Header:require("./views/Header"),Home:require("./views/Home"),Login:require("./views/Login"),User:require("./views/User"),UserManage:require("./views/UserManage"),UserResources:require("./views/UserResources")}},{"./views/Admin":10,"./views/AdminItem":11,"./views/Comic":12,"./views/ComicManage":13,"./views/ComicResources":14,"./views/Header":15,"./views/Home":16,"./views/Login":17,"./views/User":18,"./views/UserManage":19,"./views/UserResources":20}],3:[function(require,module,exports){window.cookieName="cheetojesus"},{}],4:[function(require,module,exports){"use strict";module.exports=Object.create(Object.assign({},require("../../lib/MyObject"),{Request:{constructor:function constructor(data){var _this=this;var req=new XMLHttpRequest;return new Promise(function(resolve,reject){req.onload=function(){[500,404,401].includes(this.status)?reject(this.response):resolve(JSON.parse(this.response))};if(data.method==="get"||data.method==="options"){var qs=data.qs?"?"+data.qs:"";req.open(data.method,"/"+data.resource+qs);_this.setHeaders(req,data.headers);req.send(null)}else{req.open(data.method,"/"+data.resource,true);_this.setHeaders(req,data.headers);req.send(data.data)}})},plainEscape:function plainEscape(sText){return sText.replace(/[\s\=\\]/g,"\\$&")},setHeaders:function setHeaders(req){var headers=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};req.setRequestHeader("Accept",headers.accept||"application/json");req.setRequestHeader("Content-Type",headers.contentType||"text/plain")}},_factory:function _factory(data){return Object.create(this.Request,{}).constructor(data)},constructor:function constructor(){if(!XMLHttpRequest.prototype.sendAsBinary){XMLHttpRequest.prototype.sendAsBinary=function(sData){var nBytes=sData.length,ui8Data=new Uint8Array(nBytes);for(var nIdx=0;nIdx<nBytes;nIdx++){ui8Data[nIdx]=sData.charCodeAt(nIdx)&255}this.send(ui8Data)}}return this._factory.bind(this)}}),{}).constructor()},{"../../lib/MyObject":36}],5:[function(require,module,exports){"use strict";module.exports=Object.create({create:function create(name,opts){var lower=name;name=name.charAt(0).toUpperCase()+name.slice(1);return Object.create(this.Views[name],Object.assign({name:{value:name},factory:{value:this},template:{value:this.Templates[name]},user:{value:this.User}},opts)).constructor().on("navigate",function(route){return require("../router").navigate(route)}).on("deleted",function(){return delete require("../router").views[name]})}},{Templates:{value:require("../.TemplateMap")},User:{value:require("../models/User")},Views:{value:require("../.ViewMap")}})},{"../.TemplateMap":1,"../.ViewMap":2,"../models/User":7,"../router":9}],6:[function(require,module,exports){"use strict";window.onload=function(){require("./.env");require("./router").initialize()}},{"./.env":3,"./router":9}],7:[function(require,module,exports){"use strict";module.exports=Object.create(require("./__proto__.js"),{resource:{value:"me"}})},{"./__proto__.js":8}],8:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("../../../lib/MyObject"),require("events").EventEmitter.prototype,{Xhr:require("../Xhr"),get:function get(){var _this=this;var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(opts.query&&this.pagination)Object.assign(opts.query,this.pagination);return this.Xhr({method:opts.method||"get",resource:this.resource,headers:this.headers||{},qs:opts.query?JSON.stringify(opts.query):undefined}).then(function(response){if(!_this.pagination)return Promise.resolve(_this.data=response);if(!_this.data)_this.data=[];_this.data=_this.data.concat(response);_this.pagination.skip+=_this.pagination.limit;return Promise.resolve(response)})}})},{"../../../lib/MyObject":36,"../Xhr":4,events:37}],9:[function(require,module,exports){"use strict";module.exports=Object.create({Error:require("../../lib/MyError"),User:require("./models/User"),ViewFactory:require("./factory/View"),Views:require("./.ViewMap"),initialize:function initialize(){var _this=this;this.contentContainer=document.querySelector("#content");window.onpopstate=this.handle.bind(this);this.header=this.ViewFactory.create("header",{insertion:{value:{el:this.contentContainer,method:"insertBefore"}}});this.User.get().then(function(){return _this.header.onUser().on("signout",function(){return Promise.all(Object.keys(_this.views).map(function(name){return _this.views[name].delete()})).then(function(){return _this.header.emit("navigate","/")}).catch(_this.Error)})}).catch(this.Error).then(function(){return _this.handle()});return this},handle:function handle(){this.handler(window.location.pathname.split("/").slice(1))},handler:function handler(path){var _this2=this;var name=path[0]?path[0].charAt(0).toUpperCase()+path[0].slice(1):"",view=this.Views[name]?path[0]:"home";console.log(path);(view===this.currentView?Promise.resolve():Promise.all(Object.keys(this.views).map(function(view){return _this2.views[view].hide()}))).then(function(){_this2.currentView=view;if(_this2.views[view])return _this2.views[view].navigate(path);return Promise.resolve(_this2.views[view]=_this2.ViewFactory.create(view,{insertion:{value:{el:_this2.contentContainer}},path:{value:path,writable:true}}))}).catch(this.Error)},navigate:function navigate(location){history.pushState({},"",location);this.handle()}},{currentView:{value:"",writable:true},views:{value:{}}})},{"../../lib/MyError":35,"./.ViewMap":2,"./factory/View":5,"./models/User":7}],10:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{"delete":function _delete(){var _this=this;return Promise.all(Object.keys(this.subViews).map(function(subView){return _this.subViews[subView].delete()})).then(function(){return require("./__proto__").delete.call(_this)})},navigate:function navigate(path){var _this2=this;this.path=path;return path.length===1&&this.els.container.classList.contains("hide")?Promise.all(Object.keys(this.subViews).map(function(view){return _this2.subViews[view].hide()})).then(function(){return _this2.show()}).catch(this.Error):this.path.length>1?this.els.container.classList.contains("hide")?this.renderSubView():this.hide().then(function(){return _this2.renderSubView()}):Promise.resolve()},postRender:function postRender(){var _this3=this;this.views={};this.subViews={};if(this.path.length>1){this.els.container.classList.add("hide","hidden");this.renderSubView()}this.options=Object.create(this.Model,{resource:{value:"admin"}});this.options.get({method:"options"}).then(function(){return _this3.options.data.forEach(function(collection){return _this3.views[collection]=_this3.factory.create("AdminItem",{insertion:{value:{el:_this3.els.list}},model:{value:{data:{collection:collection}}}})})}).catch(this.Error);return this},renderSubView:function renderSubView(){var subViewName=this.capitalizeFirstLetter(this.path[1])+"Resources";return this.subViews[subViewName]?this.subViews[subViewName].onNavigation(this.path):this.subViews[subViewName]=this.factory.create(subViewName,{path:{value:this.path,writable:true},insertion:{value:{el:this.els.container,method:"insertBefore"}}})},requiresLogin:true})},{"./__proto__":21}],11:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{container:"click"},onContainerClick:function onContainerClick(){this.emit("navigate","/admin/"+this.model.data.collection)}})},{"./__proto__":21}],12:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{cancel:"click",confirm:"click","delete":"click",edit:"click"},onCancelClick:function onCancelClick(){this.els.header.classList.remove("hidden");this.els.confirmDialog.classList.add("hidden")},onConfirmClick:function onConfirmClick(){this.emit("delete")},onDeleteClick:function onDeleteClick(){if(this.user&&this.user.data._id){this.els.header.classList.add("hidden");this.els.confirmDialog.classList.remove("hidden")}},onEditClick:function onEditClick(){if(this.user&&this.user.data._id)this.emit("edit")},update:function update(comic){this.model.data=comic;this.els.title.textContent=comic.title;this.els.image.src=comic.image+"?"+(new Date).getTime()}})},{"./__proto__":21}],13:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{cancel:"click",submit:"click"},onCancelClick:function onCancelClick(){var _this=this;this.hide().then(function(){return _this.emit("cancelled")})},onSubmitClick:function onSubmitClick(){this["request"+this.capitalizeFirstLetter(this.type)]().catch(this.Error)},onNavigation:function onNavigation(type,comic){this.type=type;this.model.data=comic;this.populate();if(this.els.container.classList.contains("hide"))this.show()},populate:function populate(){this.els.header.textContent=this.capitalizeFirstLetter(this.type)+" Comic";if(Object.keys(this.model.data).length){this.els.title.value=this.model.data.title||"";this.els.preview.src=this.model.data.image}else{this.els.title.value="";this.els.preview.src=""}},postRender:function postRender(){var _this2=this;this.spinner=new this.Spinner({color:"#fff",length:15,scale:.25,width:5}).spin();this.populate();this.els.image.addEventListener("change",function(e){var base64Reader=new FileReader,binaryReader=new FileReader;_this2.els.upload.classList.add("has-spinner");_this2.els.upload.appendChild(_this2.spinner.spin().el);base64Reader.onload=function(evt){_this2.file=evt.target.result;_this2.els.upload.classList.remove("has-spinner");_this2.spinner.stop();_this2.els.preview.src=evt.target.result;binaryReader.onload=function(event){return _this2.binaryFile=event.target.result};binaryReader.readAsArrayBuffer(e.target.files[0])};base64Reader.readAsDataURL(e.target.files[0])});return this},requestAdd:function requestAdd(){var _this3=this;return this.Xhr({method:"POST",resource:"file",data:this.binaryFile,headers:{contentType:"application/octet-stream"}}).then(function(response){return _this3.Xhr({method:"POST",resource:"comic",data:JSON.stringify({title:_this3.els.title.value,image:response.path})})}).then(function(response){return _this3.hide().then(function(){return _this3.emit("added",response)})})},requestEdit:function requestEdit(){var _this4=this;var data={title:this.els.title.value};return(this.binaryFile?this.Xhr({method:"PATCH",resource:"file/"+this.model.data.image.split("/")[3],data:this.binaryFile,headers:{contentType:"application/octet-stream"}}):Promise.resolve()).then(function(){return _this4.Xhr({method:"PATCH",resource:"comic/"+_this4.model.data._id,data:JSON.stringify(data)})}).then(function(response){return _this4.hide().then(function(){return _this4.emit("edited",response)})})}})},{"./__proto__":21}],14:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{createComicView:function createComicView(comic){var _this=this;this.views[comic._id]=this.factory.create("Comic",{insertion:{value:{el:this.els.list}},model:{value:{data:comic}}});this.views[comic._id].on("edit",function(){return _this.emit("navigate","/admin/comic/edit/"+comic._id)}).on("delete",function(){return _this.Xhr({method:"delete",resource:"comic/"+comic._id}).then(function(){return _this.views[comic._id].delete()}).catch(_this.Error)})},"delete":function _delete(){var _this2=this;return(this.views.ComicManage?this.views.ComicManage.delete():Promise.resolve()).then(function(){return require("./__proto__").delete.call(_this2)})},events:{addBtn:"click"},manageComic:function manageComic(type,comic){var _this3=this;this.views.ComicManage?this.views.ComicManage.onNavigation(type,comic):this.views.ComicManage=this.factory.create("ComicManage",{type:{value:type,writable:true},model:{value:{data:comic||{}}},insertion:{value:{el:this.els.container,method:"insertBefore"}}}).on("added",function(comic){_this3.createComicView(comic);_this3.emit("navigate","/admin/comic")}).on("cancelled",function(){return _this3.emit("navigate","/admin/comic")}).on("edited",function(comic){_this3.views[comic._id].update(comic);_this3.emit("navigate","/admin/comic")})},onAddBtnClick:function onAddBtnClick(){this.emit("navigate","/admin/comic/add")},onNavigation:function onNavigation(path){var _this4=this;this.path=path;path.length===2&&this.els.container.classList.contains("hide")?this.views.ComicManage&&!this.views.ComicManage.els.container.classList.contains("hide")?this.views.ComicManage.hide().then(function(){return _this4.show()}):this.show():path.length===3?this.hide().then(function(){return _this4.manageComic(path[2],{})}):path.length===4?this.hide().then(function(){return _this4.manageComic(path[2],_this4.views[path[3]].model.data)}):undefined},postRender:function postRender(){var _this5=this;if(this.path.length>2){this.els.container.classList.add("hidden","hide");if(this.path[2]==="add"){this.manageComic("add",{})}else if(this.path[2]==="edit"&&this.path[3]){this.Xhr({method:"get",resource:"comic/"+this.path[3]}).then(function(response){return _this5.manageComic("edit",response)}).catch(function(e){_this5.Error(e);_this5.emit("navigate","/admin/comic")})}}else if(this.path.length===1&&this.views.ComicManage){this.views.ComicManage.hide()}this.comics=Object.create(this.Model,{resource:{value:"comic"}});this.comics.get().then(function(){return Promise.resolve(_this5.comics.data.forEach(function(comic){return _this5.createComicView(comic)}))}).catch(this.Error);return this},requiresLogin:true})},{"./__proto__":21}],15:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{logo:"click"},onUser:function onUser(){return this},onLogoClick:function onLogoClick(){this.signout()},requiresLogin:false,signout:function signout(){document.cookie=window.cookieName+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";this.user.data={};this.emit("signout")}})},{"./__proto__":21}],16:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{fetchAndDisplay:function fetchAndDisplay(){var _this=this;return this.getData().then(function(response){return response.forEach(function(comic){return _this.views[comic._id]=_this.factory.create("comic",{insertion:{value:{el:_this.els.container}},model:{value:{data:comic}},templateOpts:{value:{readOnly:true}}})})})},getData:function getData(){if(!this.model)this.model=Object.create(this.Model,{pagination:{value:{skip:0,limit:10,sort:{created:-1}}},resource:{value:"comic"}});return this.model.get()},navigate:function navigate(){this.show()},postRender:function postRender(){this.fetchAndDisplay().catch(this.Error);return this}})},{"./__proto__":21}],17:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{submit:"click"},onSubmitClick:function onSubmitClick(){var _this=this;this.Xhr({method:"post",resource:"auth",data:JSON.stringify({username:this.els.username.value,password:this.els.password.value})}).then(function(){return _this.user.get()}).then(function(){return _this.hide()}).then(function(){return Promise.resolve(_this.emit("loggedIn"))}).catch(this.Error)}})},{"./__proto__":21}],18:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{cancel:"click",confirm:"click","delete":"click",edit:"click"},onCancelClick:function onCancelClick(){this.els.username.classList.remove("hidden");this.els.confirmDialog.classList.add("hidden")},onConfirmClick:function onConfirmClick(){this.emit("delete")},onDeleteClick:function onDeleteClick(){if(this.user&&this.user.data._id){this.els.username.classList.add("hidden");this.els.confirmDialog.classList.remove("hidden")}},onEditClick:function onEditClick(){if(this.user&&this.user.data._id)this.emit("edit")},update:function update(user){this.user.data=user;this.els.username.textContent=user.username}})},{"./__proto__":21}],19:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{events:{cancel:"click",submit:"click"},onCancelClick:function onCancelClick(){var _this=this;this.hide().then(function(){return _this.emit("cancelled")})},onSubmitClick:function onSubmitClick(){this["request"+this.capitalizeFirstLetter(this.type)]().catch(this.Error)},onNavigation:function onNavigation(type,comic){this.type=type;this.model.data=comic;this.populate();if(this.els.container.classList.contains("hide"))this.show()},populate:function populate(){this.els.title.textContent=this.capitalizeFirstLetter(this.type)+" User";this.els.username.value=Object.keys(this.model.data).length?this.model.data.username:"";this.els.password.value=""},postRender:function postRender(){this.populate();return this},requestAdd:function requestAdd(){var _this2=this;if(this.els.password.value.length===0)return;return this.Xhr({method:"POST",resource:"user",data:JSON.stringify({username:this.els.username.value,password:this.els.password.value})}).then(function(response){return _this2.hide().then(function(){return _this2.emit("added",{_id:response._id,username:response.username})})})},requestEdit:function requestEdit(){var _this3=this;var data={username:this.els.username.value};if(this.els.password.value.length)data.password=this.els.password.value;return this.Xhr({method:"PATCH",resource:"user/"+this.user.data._id,data:JSON.stringify(data)}).then(function(response){return _this3.hide().then(function(){return _this3.emit("edited",{_id:response._id,username:response.username})})})}})},{"./__proto__":21}],20:[function(require,module,exports){"use strict";module.exports=Object.assign({},require("./__proto__"),{createUserView:function createUserView(user){var _this=this;this.views[user._id]=this.factory.create("User",{insertion:{value:{el:this.els.list}},model:{value:{data:user}}});this.views[user._id].on("edit",function(){return _this.emit("navigate","/admin/user/edit/"+user._id)}).on("delete",function(){return _this.Xhr({method:"delete",resource:"user/"+user._id}).then(function(){return _this.views[user._id].delete()}).catch(_this.Error)})},"delete":function _delete(){var _this2=this;return(this.views.UserManage?this.views.UserManage.delete():Promise.resolve()).then(function(){return require("./__proto__").delete.call(_this2)})},events:{addBtn:"click"},manageUser:function manageUser(type,user){var _this3=this;this.views.UserManage?this.views.UserManage.onNavigation(type,user):this.views.UserManage=this.factory.create("UserManage",{type:{value:type,writable:true},model:{value:{data:user||{}}},insertion:{value:{el:this.els.container,method:"insertBefore"}}}).on("added",function(user){_this3.createUserView(user);_this3.emit("navigate","/admin/user")}).on("edited",function(user){_this3.views[user._id].update(user);_this3.emit("navigate","/admin/user")}).on("cancelled",function(){return _this3.emit("navigate","/admin/user")})},onAddBtnClick:function onAddBtnClick(){this.emit("navigate","/admin/user/add")},onNavigation:function onNavigation(path){var _this4=this;this.path=path;path.length===2&&this.els.container.classList.contains("hide")?this.views.UserManage&&!this.views.UserManage.els.container.classList.contains("hide")?this.views.UserManage.hide().then(function(){return _this4.show()}):this.show():path.length===3?this.hide().then(function(){return _this4.manageUser(path[2],{})}):path.length===4?this.hide().then(function(){return _this4.manageUser(path[2],_this4.views[path[3]].model.data)}):undefined},postRender:function postRender(){var _this5=this;if(this.path.length>2){this.els.container.classList.add("hidden","hide");if(this.path[2]==="add"){this.manageUser("add",{})}else if(this.path[2]==="edit"&&this.path[3]){this.Xhr({method:"get",resource:"user/"+this.path[3]}).then(function(response){return _this5.manageUser("edit",response)}).catch(function(e){_this5.Error(e);_this5.emit("navigate","/admin/user")})}}else if(this.path.length===1&&this.views.UserManage){this.views.UserManage.hide()}this.users=Object.create(this.Model,{resource:{value:"user"}});this.users.get().then(function(){return Promise.resolve(_this5.users.data.forEach(function(user){return _this5.createUserView(user)}))}).catch(this.Error);return this},requiresLogin:true})},{"./__proto__":21}],21:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};module.exports=Object.assign({},require("../../../lib/MyObject"),require("events").EventEmitter.prototype,{Model:require("../models/__proto__.js"),OptimizedResize:require("./lib/OptimizedResize"),Spinner:require("./lib/Spin"),Xhr:require("../Xhr"),bindEvent:function bindEvent(key,event){var _this=this;var els=Array.isArray(this.els[key])?this.els[key]:[this.els[key]];els.forEach(function(el){return el.addEventListener(event||"click",function(e){return _this["on"+_this.capitalizeFirstLetter(key)+_this.capitalizeFirstLetter(event)](e)})})},capitalizeFirstLetter:function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)},constructor:function constructor(){if(this.size)this.OptimizedResize.add(this.size);if(this.requiresLogin&&(!this.user.data||!this.user.data._id))return this.handleLogin();if(this.user.data&&this.user.data.id&&this.requiresRole&&!this.hasPrivileges())return this.showNoAccess();return Object.assign(this,{els:{},slurp:{attr:"data-js",view:"data-view"},views:{}}).render()},delegateEvents:function delegateEvents(key,el){var _this2=this;var type=_typeof(this.events[key]);if(type==="string"){this.bindEvent(key,this.events[key])}else if(Array.isArray(this.events[key])){this.events[key].forEach(function(eventObj){return _this2.bindEvent(key,eventObj.event)})}else{this.bindEvent(key,this.events[key].event)}},"delete":function _delete(){var _this3=this;return this.hide().then(function(){_this3.els.container.parentNode.removeChild(_this3.els.container);return Promise.resolve(_this3.emit("deleted"))})},events:{},getData:function getData(){if(!this.model)this.model=Object.create(this.Model,{resource:{value:this.name}});return this.model.get()},getTemplateOptions:function getTemplateOptions(){return Object.assign({},this.model?this.model.data:{},{user:this.user?this.user.data:{}},{opts:this.templateOpts?this.templateOpts:{}})},handleLogin:function handleLogin(){var _this4=this;this.factory.create("login",{insertion:{value:{el:document.querySelector("#content")}}}).once("loggedIn",function(){return _this4.onLogin()});return this},hasPrivilege:function hasPrivilege(){var _this5=this;this.requiresRole&&this.user.get("roles").find(function(role){return role===_this5.requiresRole})==="undefined"?false:true},hide:function hide(){var _this6=this;return new Promise(function(resolve){if(!document.body.contains(_this6.els.container))return resolve();_this6.onHiddenProxy=function(e){return _this6.onHidden(resolve)};_this6.els.container.addEventListener("transitionend",_this6.onHiddenProxy);_this6.els.container.classList.add("hide")})},htmlToFragment:function htmlToFragment(str){var range=document.createRange();range.selectNode(document.getElementsByTagName("div").item(0));return range.createContextualFragment(str)},isHidden:function isHidden(){return this.els.container.css("display")==="none"},onHidden:function onHidden(resolve){this.els.container.removeEventListener("transitionend",this.onHiddenProxy);this.els.container.classList.add("hidden");resolve(this.emit("hidden"))},onLogin:function onLogin(){Object.assign(this,{els:{},slurp:{attr:"data-js",view:"data-view"},views:{}}).render()},onShown:function onShown(resolve){this.els.container.removeEventListener("transitionend",this.onShownProxy);if(this.size)this.size();resolve(this.emit("shown"))},showNoAccess:function showNoAccess(){alert("No privileges, son");return this},postRender:function postRender(){return this},render:function render(){this.slurpTemplate({template:this.template(this.getTemplateOptions()),insertion:this.insertion});if(this.size)this.size();return this.renderSubviews().postRender()},renderSubviews:function renderSubviews(){var _this7=this;Object.keys(this.Views||[]).forEach(function(key){if(_this7.Views[key].el){var opts=_this7.Views[key].opts;opts=opts?(typeof opts==="undefined"?"undefined":_typeof(opts))==="object"?opts:opts():{};_this7.views[key]=_this7.factory.create(key,Object.assign({insertion:{value:{el:_this7.Views[key].el,method:"insertBefore"}}},opts));_this7.Views[key].el.remove();_this7.Views[key].el=undefined}});return this},show:function show(duration){var _this8=this;return new Promise(function(resolve){_this8.onShownProxy=function(e){return _this8.onShown(resolve)};_this8.els.container.addEventListener("transitionend",_this8.onShownProxy);_this8.els.container.classList.remove("hide","hidden")})},slurpEl:function slurpEl(el){var key=el.getAttribute(this.slurp.attr)||"container";if(key==="container")el.classList.add(this.name);this.els[key]=Array.isArray(this.els[key])?this.els[key].push(el):this.els[key]!==undefined?[this.els[key],el]:el;el.removeAttribute(this.slurp.attr);if(this.events[key])this.delegateEvents(key,el)},slurpTemplate:function slurpTemplate(options){var _this9=this;var fragment=this.htmlToFragment(options.template),selector="["+this.slurp.attr+"]",viewSelector="["+this.slurp.view+"]";this.slurpEl(fragment.querySelector("*"));fragment.querySelectorAll(selector+", "+viewSelector).forEach(function(el){return el.hasAttribute(_this9.slurp.attr)?_this9.slurpEl(el):_this9.Views[el.getAttribute(_this9.slurp.view)].el=el});options.insertion.method==="insertBefore"?options.insertion.el.parentNode.insertBefore(fragment,options.insertion.el):options.insertion.el[options.insertion.method||"appendChild"](fragment);return this},isMouseOnEl:function isMouseOnEl(event,el){var elOffset=el.offset(),elHeight=el.outerHeight(true),elWidth=el.outerWidth(true);if(event.pageX<elOffset.left||event.pageX>elOffset.left+elWidth||event.pageY<elOffset.top||event.pageY>elOffset.top+elHeight){return false}return true},requiresLogin:false})},{"../../../lib/MyObject":36,"../Xhr":4,"../models/__proto__.js":8,"./lib/OptimizedResize":22,"./lib/Spin":23,events:37}],22:[function(require,module,exports){"use strict";module.exports=Object.create({add:function add(callback){if(!this.callbacks.length)window.addEventListener("resize",this.onResize);this.callbacks.push(callback)},onResize:function onResize(){if(this.running)return;this.running=true;window.requestAnimationFrame?window.requestAnimationFrame(this.runCallbacks):setTimeout(this.runCallbacks,66)},runCallbacks:function runCallbacks(){this.callbacks=this.callbacks.filter(function(callback){return callback()});this.running=false}},{callbacks:{value:[]},running:{value:false}}).add},{}],23:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(a,b){"object"==(typeof module==="undefined"?"undefined":_typeof(module))&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(undefined,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b){d[c]=b[c]}return d}function b(a){for(var b=1,c=arguments.length;c>b;b++){a.appendChild(arguments[b])}return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(k.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",k.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;if(b=b.charAt(0).toUpperCase()+b.slice(1),void 0!==e[b])return b;for(d=0;d<l.length;d++){if(c=l[d]+b,void 0!==e[c])return c}}function e(a,b){for(var c in b){a.style[d(a,c)||c]=b[c]}return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){void 0===a[d]&&(a[d]=c[d])}}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}k.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.scale*(d.length+d.width),k=2*d.scale*j,l=-(d.width+d.length)*d.scale*2+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++){h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}for(i=1;i<=d.lines;i++){h(i)}return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k,l=["webkit","Moz","ms","O"],m={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(h.defaults={},f(h.prototype,{spin:function spin(b){this.stop();var c=this,d=c.opts,f=c.el=a(null,{className:d.className});if(e(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++){g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d)}c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function stop(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),
this},lines:function lines(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.scale*(f.length+f.width)+"px",height:f.scale*f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.scale*f.radius+"px,0)",borderRadius:(f.corners*f.scale*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++){i=e(a(),{position:"absolute",top:1+~(f.scale*f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")))}return d},opacity:function opacity(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),"undefined"!=typeof document){k=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}();var o=e(a("group"),{behavior:"url(#default#VML)"});!d(o,"transform")&&o.adj?i():j=d(o,"animation")}return h})},{}],24:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n<div>Admin</div>\n<div data-js="list"></div>\n</div>'}},{}],25:[function(require,module,exports){"use strict";module.exports=function(p){return"<div>"+p.collection+"</div>"}},{}],26:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <div class="header" data-js="header">\n        <div class="title" data-js="title" >'+(p.title||"")+"</div>\n        "+(p.user._id&&!p.opts.readOnly?'<button class="delete" data-js="delete"></button>':"")+"\n        "+(p.user._id&&!p.opts.readOnly?'<button class="edit" data-js="edit"></button>':"")+"\n    </div>\n    "+(p.user._id&&!p.opts.readOnly?'<div class="confirm hidden" data-js="confirmDialog">\n               <span>Are you sure?</span>\n               <button data-js="confirm" type="button">Delete</button> \n               <button data-js="cancel" type="button">Cancel</button> \n           </div>':"")+'\n    <img data-js="image" src="'+p.image+'"/>\n</div>'}},{}],27:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <div data-js="header"></div>\n    <div class="form-group">\n       <label class="form-label">title</label>\n       <input data-js="title" type="text"></input>\n    </div>\n    <div class="form-group">\n       <label class="form-label">image</label>\n        <div>\n            <button data-js="upload" class="upload">\n                <span>Upload File</span>\n                <input type="file" data-js="image" />\n            </button>\n            <img class="preview" data-js="preview" />\n        </div>\n    </div>\n    <div class="button-row">\n        <button data-js="submit" type="button">Submit</button>\n        <button data-js="cancel" type="button">Cancel</button>\n    </div>\n</div>'}},{}],28:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <div>\n        <div>Comics</div>\n        <button data-js="addBtn" class="add"></button>\n    </div>\n    <div data-js="list"></div>\n</div>'}},{}],29:[function(require,module,exports){"use strict";module.exports=function(p){return'<header>\n    <ul>\n        <li>About</li>\n        <li>Store</li>\n    </ul>\n    <span>Tiny Handed</span>\n    <img data-js="logo" src="/static/img/tinyHanded.jpg" />\n</header>'}},{}],30:[function(require,module,exports){"use strict";module.exports=function(p){return"<div></div>"}},{}],31:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <h1>Login</h1>\n    <div class="form-group">\n       <label class="form-label" for="username">username</label>\n       <input data-js="username" class="username" type="text"></input>\n    </div>\n    <div class="form-group">\n       <label class="form-label" for="password">password</label>\n       <input data-js="password" class="password" type="password"></input>\n    </div>\n    <div class="button-row">\n        <button data-js="submit" class="btn-ghost" type="button">Log In</button>\n    </div>\n</div>'}},{}],32:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <div data-js="username">'+p.username+"</div>\n    "+(p.user._id&&!p.opts.readOnly?'<button class="delete" data-js="delete"></button>':"")+"\n    "+(p.user._id===p._id?'<button class="edit" data-js="edit"></button>':"")+"\n    "+(p.user._id&&!p.opts.readOnly?'<div class="confirm hidden" data-js="confirmDialog">\n           <span>Are you sure?</span>\n           <button data-js="confirm" type="button">Delete</button> \n           <button data-js="cancel" type="button">Cancel</button> \n       </div>':"")+"\n</div>\n"}},{}],33:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <div data-js="title"></div>\n    <div class="form-group">\n       <label class="form-label" for="username">username</label>\n       <input data-js="username" class="username" type="text"></input>\n    </div>\n    <div class="form-group">\n       <label class="form-label" for="password">password</label>\n       <input data-js="password" class="password" type="password"></input>\n    </div>\n    <div class="button-row">\n        <button data-js="submit" class="btn-ghost" type="button">Submit</button>\n        <button data-js="cancel" class="btn-ghost" type="button">Cancel</button>\n    </div>\n</div>'}},{}],34:[function(require,module,exports){"use strict";module.exports=function(p){return'<div>\n    <div>\n        <div>Users</div>\n        <button data-js="addBtn" class="add"></button>\n    </div>\n    <div data-js="list"></div>\n</div>'}},{}],35:[function(require,module,exports){"use strict";module.exports=function(err){console.log(err.stack||err)}},{}],36:[function(require,module,exports){"use strict";module.exports={Error:require("./MyError"),P:function P(fun){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var thisArg=arguments[2];return new Promise(function(resolve,reject){return Reflect.apply(fun,thisArg||undefined,args.concat(function(e){for(var _len=arguments.length,callback=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){callback[_key-1]=arguments[_key]}return e?reject(e):resolve(callback)}))})},constructor:function constructor(){return this}}},{"./MyError":35}],37:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}]},{},[6]);
